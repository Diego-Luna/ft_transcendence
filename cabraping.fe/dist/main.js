(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var n;e.g.importScripts&&(n=e.g.location+"");var t=e.g.document;if(!n&&t&&(t.currentScript&&(n=t.currentScript.src),!n)){var a=t.getElementsByTagName("script");if(a.length)for(var i=a.length-1;i>-1&&!n;)n=a[i--].src}if(!n)throw new Error("Automatic publicPath is not supported in this browser");n=n.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=n})();const n=e.p+"bfdb41f3a4dfb0f1bc4688b51ebe9838.svg";let t=null;async function a(){const e=localStorage.getItem("jwt"),a=Boolean(localStorage.getItem("jwt"));if(a){const n=await fetch("http://localhost:8000/api/me/",{headers:{Authorization:`Bearer ${e}`}});t=await n.json(),"user_not_found"!==t.code&&"token_not_valid"!==t.code||window.location.replace("/#logout")}return`\n      <header class="d-flex justify-content-between align-items-center p-3 bg-light">\n        <nav id="header-nav" class="d-flex">\n          <a href="#">\n            <img src="${n}" alt="Logo" style="height: 50px;">\n          </a>\n          ${a?'<a href="#users" class="m-3 text-dark text-decoration-none">Users</a>\n            <a href="#friends" class="m-3 text-dark text-decoration-none">Friends</a>\n            <a href="#chat" class="m-3 text-dark text-decoration-none">Chats</a>\n            <a href="#game" class="m-3 text-dark text-decoration-none">Games</a>':""}\n        </nav>\n\n        <div class="d-flex">\n          ${a?`<div>\n                  <span>${t.username}</span>\n                  <a href="/#logout" class="btn btn-primary">Logout</a>\n                </div>`:""}\n          ${a?"":'<a href="/#auth" class="btn btn-primary">Login</a>'}\n          <a href="#" class="btn btn-secondary text-white">42 Auth</a>\n        </div>\n      </header>\n     `}const i=()=>'\n    <div class="d-flex justify-content-center align-items-center p-3 bg-dark">\n        <span class="text-white">CabraPing. All rights reserved © 2023</span>\n    </div>\n  ',s=e.p+"f98c465cdaa51319739eadd988c0a8eb.png";const o=()=>location.hash.slice(1).toLocaleLowerCase().split("/")[1]||"/",r="http://localhost:8000";let c={},l=[],d="default",u=null,h=-1,m="general",f=null;function g(){const e=document.getElementById("messageTextarea");if(e&&c[m]){const n=e.value;if(""!==n.trim()){let t={message:n,channel:m,UserName:d};c[m].send(JSON.stringify(t)),e.value="",p(t)}}}function p(e){if(e.channel===m){const t=document.getElementById("messageList");if(t){const a=document.createElement("div");a.className="mb-3 d-flex align-items-start";const i=document.createElement("img");i.src=`${n}`,i.alt="User Image",i.className="rounded-circle mr-2",i.width=40;const s=document.createElement("div"),o=document.createElement("strong");o.textContent=e.UserName;const r=document.createElement("p");r.textContent=e.message,s.appendChild(o),s.appendChild(r),a.appendChild(i),a.appendChild(s),t.appendChild(a)}}}function y(){const e=document.getElementById("channelModal"),n=document.getElementById("channelMembers");e&&(e.style.display="block",fetch(`${r}/api/users/`).then((e=>e.json())).then((e=>{l=e,n.innerHTML="",e.forEach((e=>{if(e.username!=d){const t=document.createElement("option");t.textContent=e.username,t.value=e.id,n.appendChild(t)}}))})).catch((e=>{})));const t=document.getElementById("closeModalButton");t&&t.addEventListener("click",(()=>{e.style.display="none"}))}async function b(){const e=localStorage.getItem("jwt");if(!e)return void(window.location.href="/#");const n=e.split(".")[1],t=JSON.parse(atob(n));h=t.user_id;let a=o();m=a,"/"!=a&&(u=a);const i=document.getElementById("addChanel");i&&i.addEventListener("click",y);const s=document.getElementById("sendButton");s&&s.addEventListener("click",g);const l=document.getElementById("saveChannelButton");l&&l.addEventListener("click",v);let b=function(e){const n=e.split(".")[1],t=JSON.parse(atob(n));return t.user_id}(e);const w=await async function(e){const n=await fetch(`${r}/user-channels/${e}/?format=json`);return await n.json()}(b);if(w.length>0&&(!async function(e){const n=document.getElementById("channelsList");n.innerHTML="",e.forEach((e=>{const t=document.createElement("li");t.innerHTML=`<a href="#chat/${e.id}">${e.name}</a>`,n.appendChild(t),function(e){const n=new WebSocket(`ws://127.0.0.1:8000/ws/chat/${e}/`);n.addEventListener("message",(e=>{p(JSON.parse(e.data))})),c[e]=n}(e.id)}))}(w),u=w[0].id),e){const n=e.split(".")[1];b=JSON.parse(atob(n)).user_id,fetch(`${r}/user-channels/${b}/?format=json`).then((e=>e.json())).then((e=>{const n=document.getElementById("channelsList");n.innerHTML="",e.forEach((e=>{const t=document.createElement("li");0!=e.name.length?t.innerHTML=`<a href="#chat/${e.id}" class="text-decoration-none">${e.name}</a>`:t.innerHTML=`<a href="#chat/${e.id}" class="text-decoration-none">${e.id}</a>`,n.appendChild(t)}))})).catch((e=>{}))}const x=await fetch(`${r}/api/me/`,{headers:{Authorization:`Bearer ${e}`}});f=await x.json(),"user_not_found"!==f.code&&"token_not_valid"!==f.code||window.location.replace("/#logout"),d=f.username}function w(e,n){const t=document.getElementById("notification-container"),a=document.createElement("div");a.classList.add("notification",n),a.textContent=e,t.appendChild(a),setTimeout((()=>{t.removeChild(a)}),5e3)}function v(){let e=document.getElementById("channelMembers").selectedOptions,n=Array.from(e).map((e=>parseInt(e.value,10)));n.push(h);const t=l.find((e=>e.id==n[0]))?.username||"Unknown User",a={owner:h,ownerId:h,name:t,status:"working",members:n},i=`${r}/channels/create/`,s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)};fetch(i,s).then((e=>e.json())).then((e=>{e.error?w("Error there is already a chat","error"):w("Channel successfully created","success")})).catch((e=>{w("Error there is already a chat","error")}))}function x(){if(localStorage.getItem("jwt"))return`\n    <div class="d-flex h-100">\n       <div class="w-25 h-100 bg-light p-3">\n         <h3>Chat</h3>\n         <div class="mb-4">\n           <h4 class="d-flex justify-content-between">\n            Messages with all\n             <button id="addChanel"  class="btn btn-primary btn-sm">Add Channel</button>\n           </h4>\n           <ul id="channelsList" class="list-unstyled">\n             <li class="mb-2"><a href="#chat/channel-alpha" class="text-decoration-none">#channel-alpha</a></li>\n             <li class="mb-2"><a href="#chat/channel-beta" class="text-decoration-none">#channel-beta</a></li>\n             <li class="mb-2"><a href="#chat/channel-charlie" class="text-decoration-none">#channel-charlie</a></li>\n           </ul>\n         </div>\n\n\n         <div class="mt-4 d-flex align-items-center">\n           <img src="${n}" alt="User Image" class="rounded-circle mr-2" width="40">\n           <div>\n             <strong>username</strong>\n             <button class="btn btn-link p-0">Logout</button>\n           </div>\n         </div>\n       </div>\n\n       \x3c!-- Middle Panel: Chat Messages --\x3e\n       <div class="w-75 h-100 bg-white p-3 overflow-auto">\n         <h3 class="mb-4">#channel-alpha</h3>\n\n         \x3c!-- Messages go here --\x3e\n         \x3c!-- Repeat for other messages --\x3e\n         \x3c!-- Lista de mensajes --\x3e\n          <ul id="messageList" class="list-unstyled">\n            \x3c!-- Aquí se agregarán los mensajes --\x3e\n          </ul>\n\n         \x3c!-- Textarea for new messages --\x3e\n         <div class="mt-3">\n           <textarea id="messageTextarea" class="form-control" rows="3"></textarea>\n           <button id="sendButton" class="btn btn-primary mt-2">Enviar</button>\n         </div>\n       </div>\n\n    </div>\n\n    \x3c!-- Modal para crear un nuevo canal --\x3e\n    <div class="modal" tabindex="-1" role="dialog" id="channelModal">\n      <div class="modal-dialog" role="document">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h5 class="modal-title">Create Channel</h5>\n            <button id="closeModalButton" type="button" class="close" data-dismiss="modal" aria-label="Close">\n              <span aria-hidden="true">&times;</span>\n            </button>\n          </div>\n          <div class="modal-body">\n\n            <p>Members</p>\n            <select multiple class="form-control" id="channelMembers"></select>\n\n          </div>\n          <div class="modal-footer">\n            <button type="button" id="saveChannelButton" class="btn btn-primary">Save Channel</button>\n            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n          </div>\n        </div>\n      </div>\n    </div>\n    `;window.location.href="/#"}function E(){const e=localStorage.getItem("jwt");return e||(window.location.replace("/#auth"),null)}const $="http://localhost:8000";let L=[],C=[];function B(){E();return'\n    <div class="container-sm">\n      <h2>List of Users</h2>\n      <ul id="users-list" class="list-group">\n        \x3c!-- userData --\x3e\n      </ul>\n    </div>\n  '}const I="http://localhost:8000";let S={},j=[];async function T(){const e=E(),n=await fetch(`${I}/api/me/`,{headers:{Authorization:`Bearer ${e}`}});return S=await n.json(),S?'\n    <div class="container-sm">\n      <h2>All of My Friends</h2>\n      <ul id="friends-list" class="list-group">\n        \x3c!-- friendsData --\x3e\n        <p>No Friends Yet</p>\n      </ul>\n\n      <h2>Friend Requests</h2>\n      <p>We are the invitee</p>\n      <ul id="friend-requests-list" class="list-group">\n        \x3c!-- friendsData --\x3e\n        <p>No Friend Requests Yet</p>\n      </ul>\n    </div>\n  ':null}async function A(){E();const e=document.getElementById("friends-list");return e.innerHTML="",j=S.friends,Array.isArray(j)?j.length<=0?(e.innerHTML="<p>No friends yet</p>",null):void(e.innerHTML=j.map((e=>`<li id="${e.id}" class="list-group-item d-flex gap-4 align-items-center">\n  <h3>${e.username}</h3>\n</li>`)).join("")):null}async function P(){const e=E(),n=document.getElementById("friend-requests-list");n.innerHTML="";const t=await fetch(`${I}/api/friend_requests/me`,{headers:{Authorization:`Bearer ${e}`}});if(j=await t.json(),j=j.filter((e=>{if(e.to_user.id===S.id)return e})),j.length<=0)return n.innerHTML="<p>No Friend Requests Yet</p>",null;const a=j.map((e=>`<li id="${e.id}" class="list-group-item d-flex gap-4 align-items-center">\n    <h3>${e.from_user.username}</h3>\n    <div className="d-flex gap-4">\n      <button\n        type="button"\n        class="btn btn-sm btn-primary"\n        data-action="confirm"\n        data-id="${e.id}">Confirm</button>\n      <button\n        type="button"\n        class="btn btn-sm btn-secondary "\n        data-action="delete"\n        data-id="${e.id}">Delete</button>\n    </div>\n  </li>`)).join("");n.innerHTML=a}function M(e,n){const t=document.getElementById("notification-container"),a=document.createElement("div");a.classList.add("notification",n),a.textContent=e,t.appendChild(a),setTimeout((()=>{t.removeChild(a)}),5e3)}function k(){}function q(){return'\n    <div class="Error404">\n      <h2>Error 404</h2>\n    </div>\n  '}const N={"/":[function(){return`\n  <div class="container mt-5">\n    <div class="row align-items-center">\n      \x3c!-- Imagen de Pong --\x3e\n      <div class="col-md-6">\n        <img src="${s}" alt="Pong Game" class="img-fluid">\n      </div>\n\n      \x3c!-- Descripción y Botón --\x3e\n      <div class="col-md-6">\n        <h1>CabraPing</h1>\n        <p class="lead">Classic Pong: Bounce to Victory! Can you outmatch your opponent in this timeless arcade game of skill and reflexes?</p>\n        <a href="path-to-authentication" class="btn btn-warning">42 Auth</a>\n        <a href="/#auth" class="btn btn-warning">Iniciar Sesión / Registrarse</a>\n      </div>\n    </div>\n  </div>\n  `},function(){return null}],"/auth":[function(){if(!localStorage.getItem("jwt"))return'\n    <div class="container mt-5">\n      <div class="row">\n        <div class="col-md-6">\n          \x3c!-- Login Form --\x3e\n          <form id="login-form">\n            <h2>Login</h2>\n            <div class="mb-3">\n              <label for="username" class="form-label">Email</label>\n              <input type="email" class="form-control" id="username" required>\n            </div>\n            <div class="mb-3">\n              <label for="password" class="form-label">Password</label>\n              <input type="password" class="form-control" id="password" required>\n            </div>\n            <button type="submit" class="btn btn-primary">Login</button>\n          </form>\n        </div>\n        <div class="col-md-6">\n          \x3c!-- Registration Form --\x3e\n\n          <form id="signup-form">\n          <h2>Create Account</h2>\n          \x3c!-- Add additional fields as per your user model --\x3e\n          <div class="mb-3">\n          <label for="new-username" class="form-label">Email</label>\n          <input type="email" class="form-control" id="new-username" required>\n          </div>\n          <div class="mb-3">\n          <label for="new-password" class="form-label">Password</label>\n          <input type="password" class="form-control" id="new-password" required>\n          </div>\n          <button type="submit" class="btn btn-success">Create Account</button>\n          </form>\n\n          <div class="notification-container" id="notification-container" ></div>\n        </div>\n      </div>\n    </div>\n  ';window.location.href="/#"},function(){if(localStorage.getItem("jwt"))return void(window.location.href="/#");const e=document.getElementById("login-form"),n=document.getElementById("signup-form");e.addEventListener("submit",(e=>{e.preventDefault();!function(e,n){fetch("http://127.0.0.1:8000/api/token/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:n})}).then((e=>{if(e.ok)return M("successful login","success"),e.json();throw M("Incorrect username or password","error"),new Error("Login failed")})).then((e=>{localStorage.setItem("jwt",e.access),setTimeout((()=>{window.location.href="/#"}),500)})).catch((e=>{}))}(document.getElementById("username").value,document.getElementById("password").value)})),n.addEventListener("submit",(e=>{e.preventDefault();!function(e,n){const t=e.split("@")[0];fetch("http://127.0.0.1:8000/api/users/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,email:e,password:n})}).then((e=>{if(200===e.status||201===e.status)return e.json();throw new Error(`Server responded with status: ${e.status}`)})).then((e=>{M("User created successfully","success")})).catch((e=>{M("Error creating user! "+e.message,"error")}))}(document.getElementById("new-username").value,document.getElementById("new-password").value)}))}],"/logout":[function(){return localStorage.removeItem("jwt"),window.location.replace(""),""}],"/game":[function(){return'\n    <div class="w-100 h-100 d-flex gap-4">\n      <h1>game</h1>\n      <div class="game-board">\n        <canvas width="750" height="585" id="game"></canvas>\n      </div>\n    </div>\n  '},function(){const e=new WebSocket("ws://127.0.0.1:8000/ws/game/");e.onopen=function(e){},e.onmessage=function(e){!function(e){e&&void 0!==e.rightPaddlePosition&&void 0!==e.leftPaddlePosition&&e.ballPosition&&(o.y=e.rightPaddlePosition,s.y=e.leftPaddlePosition,void 0!==e.ballPosition.x&&void 0!==e.ballPosition.y&&(r.x=e.ballPosition.x,r.y=e.ballPosition.y))}(JSON.parse(e.data).message)},e.onclose=function(e){e.wasClean},e.onerror=function(e){};const n=document.getElementById("game"),t=n.getContext("2d"),a=15,i=n.height-a-75;let s={x:30,y:n.height/2-37.5,width:a,height:75,dy:0},o={x:n.width-45,y:n.height/2-37.5,width:a,height:75,dy:0},r={x:n.width/2,y:n.height/2,width:a,height:a,resetting:!1,dx:5,dy:-5};function c(e,n){return e.x<n.x+n.width&&e.x+e.width>n.x&&e.y<n.y+n.height&&e.y+e.height>n.y}function l(){const n={rightPaddlePosition:o.y,leftPaddlePosition:s.y,ballPosition:{x:r.x,y:r.y}};e.send(JSON.stringify(n))}document.addEventListener("keydown",(function(e){38===e.which?o.dy=-6:40===e.which&&(o.dy=6),87===e.which?s.dy=-6:83===e.which&&(s.dy=6),l()})),document.addEventListener("keyup",(function(e){38!==e.which&&40!==e.which||(o.dy=0),83!==e.which&&87!==e.which||(s.dy=0),l()})),requestAnimationFrame((function e(){requestAnimationFrame(e),t.clearRect(0,0,n.width,n.height),s.y+=s.dy,o.y+=o.dy,s.y<a?s.y=a:s.y>i&&(s.y=i),o.y<a?o.y=a:o.y>i&&(o.y=i),t.fillStyle="white",t.fillRect(s.x,s.y,s.width,s.height),t.fillRect(o.x,o.y,o.width,o.height),r.x+=r.dx,r.y+=r.dy,r.y<a?(r.y=a,r.dy*=-1):r.y+a>n.height-a&&(r.y=n.height-30,r.dy*=-1),(r.x<0||r.x>n.width)&&!r.resetting&&(r.resetting=!0,setTimeout((()=>{r.resetting=!1,r.x=n.width/2,r.y=n.height/2}),400)),c(r,s)?(r.dx*=-1,r.x=s.x+s.width):c(r,o)&&(r.dx*=-1,r.x=o.x-r.width),t.fillRect(r.x,r.y,r.width,r.height),t.fillStyle="lightgrey",t.fillRect(0,0,n.width,a),t.fillRect(0,n.height-a,n.width,n.height);for(let e=a;e<n.height-a;e+=30)t.fillRect(n.width/2-7.5,e,a,a)}))}],"/chat":[x,b],"/chat/:id":[x,b],"/user":[function(){return'\n    <div class="User" >\n        <h2> User </h2>\n    </div>\n  '},function(){}],"/users":[B,async function e(){const n=localStorage.getItem("jwt");if(!n)return null;const t=await fetch(`${$}/api/me/`,{headers:{Authorization:`Bearer ${n}`}}),a=await t.json();if(!a)return null;const i=await fetch(`${$}/api/users/`);if(L=await i.json(),!L)return null;const s=await fetch(`${$}/api/friend_requests/me`,{headers:{Authorization:`Bearer ${n}`}});C=await s.json(),L=L.map((e=>{const n=C.find((n=>n.to_user.id===e.id));return Boolean(n)?{...e,isSentFriendRequest:!0}:e})),document.getElementById("users-list").innerHTML=L.map((e=>{const n=e.id===a.id,t=e.friends.find((e=>e===a.id));return`\n  <li class="list-group-item d-flex gap-4 align-items-center">\n      <h3>${e.username}</h3>\n      ${n||t||e.isSentFriendRequest?"":`<button\n              type="button"\n              class="btn btn-primary btn-sm"\n              data-action="create-friend-request"\n              data-id="${e.id}"\n              >Add Friend</button>`}\n\n      ${e.isSentFriendRequest?'<button\n              disabled\n              type="button"\n              class="btn btn-primary btn-sm"\n              >Added Friend</button>':""}\n\n      ${t?"<span>Your friend</span>":""}\n  </li>\n  `})).join(""),document.querySelectorAll('[data-action="create-friend-request"]').forEach((t=>{t.addEventListener("click",(async t=>{const a=Number(t.target.getAttribute("data-id"));await fetch(`${$}/api/friend_requests/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({to_user:a})}),B(),e()}))}))}],"/friends":[T,A,P,async function(){const e=E(),n=document.querySelectorAll('[data-action="confirm"]'),t=document.querySelectorAll('[data-action="delete"]');n.forEach((n=>{n.addEventListener("click",(async n=>{const t=n.target.getAttribute("data-id");await fetch(`${I}/api/friend_requests/${t}/`,{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({intent:"confirm"})}),T(),A(),P()}))})),t.forEach((n=>{n.addEventListener("click",(async n=>{const t=n.target.getAttribute("data-id");await fetch(`${I}/api/friend_requests/${t}/`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}});T(),A(),P()}))}))}]},_=async()=>{let e,n;const t=document.getElementById("header"),s=document.getElementById("content"),r=document.getElementById("footer");t.innerHTML=await a(),r.innerHTML=await i();let c=location.hash.slice(1).toLocaleLowerCase().split("/");n="/"!=o()?`/${c[0]}/:id`:`/${c[0]}`,e=c.length>=1&&c.length<=2&&N[n]?N[`/${c[0]}`]:[q,k],s.innerHTML=await e[0]();for(let n=1;n<e.length;n++)await e[n]()};window.addEventListener("load",_),window.addEventListener("hashchange",_)})();